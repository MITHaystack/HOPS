%
% A starter on coverage and unit testing
%
\section{Regression Testing}
\label{sec:regress}

this can be words about internal regression testing with autotools
(which we can do now...)


\subsection{Regression Tests with Captured Data}
\label{sec:captdatareq}

% ./data/ff_testdata/Makefile.am
In addition to the above tests, data from a variety of experiments
has been captured and are routinely refringed as part of the
HOPS build ``check'' process.  Data from two of
these are packaged with the HOPS distribution:

\begin{description}
\reqid{A} \texttt{chk\_ff\_2836.sh} a canonical S--X geodetic experiment
\reqid{A} \texttt{chk\_ff\_3365.sh} an early \ac{EHT} session suitable for
    testing \ac{fourmer}
\end{description}
Both of these tests exercise the basic fringe search and reduction
that \acs{fourfit} was built to do and have been the basis of standard
regression for HOPS and distribution validation.   Additional tests
with other captured data sets are discussed in the next section.



%Some additional tests extant in \ac{HOPS} should not be needed in
%\ac{MHO}; these are listed for reference in \App~\ref{sec:obsolete}.

%\subsection{Software-Testable Requirements}
%\label{sec:regress}

%It is anticipated that each of these tests will be captured by a
%script that may be executed on a regular basis, possibly requiring
%user intervention.  For example, when run in an interactive mode,
%\ac{fourfit} displays fringe plots which require a human to acknowledge
%that they have in fact been displayed.  (One can test the generation of
%the plot without a human, but the display mechanics require visual
%inspection.)

% ./sub/dfio/copypage/Makefile.am

Additional scans have been captured with fringe tests captured
in the \ac{HOPS} development system.  (That is, the tests exist,
but the data is not included in the distribution tarball.)


% ./data/ff_testdata/Makefile.am
\begin{description}
\reqid{S} verify that experiment 2843 fringes consistently.
  \reqex{currently done with \texttt{chk\_ff\_2843.sh} in HOPS}
\reqid{S} verify that experiment 3372 fringes consistently.
  \reqex{currently done with \texttt{chk\_ff\_3372.sh} in HOPS}
\reqid{S} verify that experiment 3413 fringes consistently.
  \reqex{currently done with \texttt{chk\_ff\_3413.sh} in HOPS}

\reqid{P} Regression tests of 2017 or 2018 data samples
  \reqex{Among the so-called ``golden'' scan data which has been
    captured for \acs{DiFX} regression testing, there are scans
    which can be refringed and \acs{A-list} manipulated and compared
    with previous results.  As set that is sufficient to guarantee
    consistency with published results is required.  Reprocessing
    the entire 2017 and 2018 data is not required.}

\end{description}

Additional test data has been captured from the (very) successful
2017 \ac{EHT} observations.  Fringing of these scans has not yet
been incorporated into HOPS testing, but shall form the basis
of regression for HOPS4.

It is anticipated that for these a mechanism shall be provided
so that they human need merely acknowledge success, failure or
make a note of issues.

Currently captured for \acs{DiFX} regression testing are the first 20 seconds
on the following experiment-release-subband-doy-hhmm samples:
\begin{verbatim}
e17d05-7-hi-095-0839 e17d05-7-lo-095-0839 e17d05-7-pc-095-0839
e17b06-7-hi-096-0750 e17b06-7-lo-096-0750 e17b06-7-pc-096-0750
e17c07-7-hi-097-1303 e17c07-7-lo-097-1303 e17c07-7-pc-097-1303
e17a10-7-hi-100-0725 e17a10-7-lo-100-0725 e17a10-7-pc-100-0725
e17e11-7-hi-101-0322 e17e11-7-hi-101-0803 e17e11-7-lo-101-0322
e17e11-7-lo-101-0803 e17e11-7-pc-101-0322 e17e11-7-pc-101-0803
\end{verbatim}
``lo'' and ``hi'' refer to the ``b3'' and ``b4'' sub-bands of the
64 \acs{Gbps} (2018 and onwards) frequency setup; ``pc'' refers to polconverted,rather than the mixed polarization correlation products.

\TBC\FIX[---is this a sufficient set?]

These or other scans could also be captured for full scan duration and
segmented at some interval, but it is not clear that this is necessary.

\subsection{Regression testing to be applied to following requirements}
\label{sec:regressreqs}

\begin{description}
% Post Processing and Fringe Plots
\reqid{A} The ability to explore fringes (as is currently done with the
  combination of \acs{fringex}, \acs{average} and search must be preserved.
  HOPS4 shall support \acs{Python} scripting to aid the user in searching
  fringe space.
\reqid{P} It should be possible to make 3D visualization plots.
\reqex{\acs{search} makes contour plots, but a 3D visualization of amplitude
  with delay and delay-rate would be useful.}
\reqid{P} HOPS4 shall implement interactive visualization tools in \acs{fourfit}.
\reqex{The HOPS3 version of \acs{fourfit} provides a fixed fringe summary
  plot. HOPS4 should have an interactive plotting capability to enable zooming
  and viewing fourfit results with an expanded scale.}
\reqid{D} Replace the existing \acs{fourfit} control file with a
  \acs{Python}-based control file. Currently existing functionality shall be
  preserved.
\reqex{The existing control file should continue to be supported. The new
  control file functionality will not likely be back-ported to HOPS3.}

% Miscellaneous Requirements
\reqid{A} It shall be possible to automatically discard correlator
  \acs{AP} (integrations) with small weights.
\reqid{A} HOPS4 shall have the ability to flag data based on a user-supplied
  list (\eg~of frequency intervals with time in some flag file).
\reqid{A} Every data type written to disk in HOPS4 shall be convertable to
  form that is amenable to human examination (e.g. ASCII or CSV), as is done in HOPS3 by the
  \texttt{\acs{CorAsc2}} program.
\reqid{A} HOPS4 shall implement an algorithm for solving for station-based
  quantities from baseline-based quantities as a global fringe fitter.
\reqid{A} The HOPS4 \acs{fourfit} shall have the ability to apply complex
  bandpass correction.
\reqid{A} HOPS4 shall provide a method to solve for complex bandpass corrections.
\reqid{A} Python wrappers for the new HOPS4 data objects shall be provided.
\reqex{The existing wrappers for the \acs{Mk4} data types in HOPS3 do not
  need to be preserved, but it is a capability worth preserving.}
\reqid{D} The HOPS4 suite must provide mechanisms to preserve the correlator
  output data.
\reqid{D} HOPS4 should preserve the the Single Band Delay, Multi Band Delay
  and Delay Rate search algorithm in its current form.
\reqex{Our desire is to make the algorithm modular, such that the user may (de)select search
  dimensions.
\reqid{D} Benchmarking and performance analysis should be augmented with
  more sophisticated tools.
\reqid{D} HOPS4 should support spectral-line VLBI.
\reqid{D} HOPS4 should support pulsar folding with a user specified period or
  ephemeris file with blanking.
\reqid{D} HOPS4 should enable multi-threading or multi-processing for batch jobs.
\end{description}

%
% eof
%
